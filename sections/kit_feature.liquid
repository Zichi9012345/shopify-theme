{% liquid %}
  assign in_all_collection = false
  if collection and collection.handle == 'all'
    assign in_all_collection = true
  endif

  # Allow manual selection; otherwise auto-detect first kit in this collection
  assign kit_product = section.settings.kit_product

  if kit_product == blank and collection and in_all_collection == false
    for p in collection.products
      assign is_kit = p.metafields.custom.is_kit.value
      if is_kit == true
        assign kit_product = p
        break
      endif
    endfor
  endif
%}

{% if in_all_collection == false and kit_product %}
  {% comment %} Non mostrare il kit se la collection corrente Ã¨ una categoria con squadre collegate {% endcomment %}
  {% assign teams_count = 0 %}
  {% if collection %}
    {% for c in collections %}
      {% assign parent = c.metafields.custom.parent_category.value %}
      {% if parent != blank and parent == collection.title %}
        {% assign teams_count = teams_count | plus: 1 %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {% unless teams_count > 0 %}
  <div class="section section--page-width spacing-style" style="{% render 'spacing-style', settings: section.settings %}">
    <div class="section__header">
      <h2 class="section__title">{{ section.settings.heading | default: 'Kit squadra' }}</h2>
    </div>

    <ul class="product-grid" role="list">
      <li class="product-grid__item product-grid__item--kit" id="kit-{{ kit_product.id }}" data-product-id="{{ kit_product.id }}">
        {% # theme-check-disable %}
        {% content_for 'block', type: '_product-card', id: 'product-card', closest.product: kit_product %}
        {% # theme-check-enable %}
      </li>
    </ul>
  </div>
  {% endunless %}
{% endif %}

{% schema %}
{
  "name": "Kit in evidenza",
  "class": "ui-test-kit-feature",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Titolo",
      "default": "Kit squadra"
    },
    {
      "type": "product",
      "id": "kit_product",
      "label": "Prodotto kit (opzionale)"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Spazio sopra",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Spazio sotto",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}