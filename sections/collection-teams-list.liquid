{% assign parent_title = collection.title %}
{% assign teams = '' %}
{% assign teams_count = 0 %}

{% comment %} Auto-rileva le collection squadra tramite metafield parent_category {% endcomment %}
{% for c in collections %}
  {% assign parent = c.metafields.custom.parent_category.value %}
  {% if parent != blank and parent == parent_title %}
    {% assign teams = teams | append: c.handle | append: ',' %}
    {% assign teams_count = teams_count | plus: 1 %}
  {% endif %}
{% endfor %}

{% assign teams_array = teams | split: ',' %}

<div class="section section--page-width spacing-style" style="{% render 'spacing-style', settings: section.settings %}">
  {% comment %} Intestazione rimossa: non mostriamo il titolo della sezione {% endcomment %}

  {% if teams_count > 0 %}
    <style>
      #teams-{{ section.id }} { --team-card-size: 200px; --team-card-size-mobile: 140px; }
      /* La griglia Ã¨ l'elemento con id #teams-<section.id> */
      #teams-{{ section.id }} { list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat({{ section.settings.columns }}, 1fr); gap: {{ section.settings.columns_gap }}px; justify-items: center; }
      @media (max-width: 750px) { #teams-{{ section.id }} { grid-template-columns: repeat(2, 1fr); } }
      #teams-{{ section.id }} .collection-grid__item { list-style: none; }
      #teams-{{ section.id }} .collection-card { width: var(--team-card-size); display: flex; flex-direction: column; height: 100%; border-radius: 14px; overflow: hidden; background: var(--color-background); border: 1px solid rgba(255,255,255,0.08); text-decoration: none; transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease; }
      @media (max-width: 750px) { #teams-{{ section.id }} .collection-card { width: var(--team-card-size-mobile); } }
      #teams-{{ section.id }} .collection-card:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(0,0,0,.25); border-color: rgba(255,255,255,0.16); }
      #teams-{{ section.id }} .collection-card__media { aspect-ratio: 1 / 1; width: 100%; display: flex; align-items: center; justify-content: center; background: var(--color-background-strong, #0e0e10); padding: 16px; }
      #teams-{{ section.id }} .collection-card__media img { width: 100%; height: 100%; object-fit: contain; transition: transform .2s ease; display: block; }
      #teams-{{ section.id }} .collection-card:hover .collection-card__media img { transform: scale(1.02); }
      #teams-{{ section.id }} .collection-card__title { padding: 10px 12px; font-weight: 600; text-align: center; color: var(--color-foreground); font-size: 0.95rem; }
      #teams-{{ section.id }} .collection-card:hover .collection-card__title { color: var(--color-foreground-strong, #fff); }
    </style>
    <ul id="teams-{{ section.id }}" class="collection-grid" role="list">
      {% for handle in teams_array %}
        {% assign team_collection = collections[handle] %}
        {% if team_collection %}
          <li class="collection-grid__item">
            <a href="{{ team_collection.url }}" class="collection-card" aria-label="{{ team_collection.title }}">
              <div class="collection-card__media">
                {% if team_collection.featured_image %}
                  {{ team_collection.featured_image | image_url: width: 400 | image_tag: alt: team_collection.title, loading: 'lazy' }}
                {% else %}
                  <div class="collection-card__placeholder">{{ 'collection-1' | placeholder_svg_tag }}</div>
                {% endif %}
              </div>
              <div class="collection-card__title">{{ team_collection.title }}</div>
            </a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  {% else %}
    {% comment %} Nessuna squadra: non mostriamo nulla su pagine squadra o categorie senza figli {% endcomment %}
  {% endif %}
</div>

{% schema %}
{
  "name": "Squadre della categoria",
  "class": "ui-test-collection-teams-list",
  "settings": [
    { "type": "checkbox", "id": "show_heading", "label": "Mostra intestazione", "default": true },
    { "type": "text", "id": "heading", "label": "Titolo", "default": "Squadre" },
    { "type": "range", "id": "columns", "label": "Colonne", "min": 1, "max": 6, "step": 1, "default": 3 },
    { "type": "range", "id": "columns_gap", "label": "Spaziatura orizzontale", "min": 0, "max": 40, "step": 1, "unit": "px", "default": 12 },
    { "type": "header", "content": "Padding" },
    { "type": "range", "id": "padding-block-start", "label": "Spazio sopra", "min": 0, "max": 100, "step": 1, "unit": "px", "default": 24 },
    { "type": "range", "id": "padding-block-end", "label": "Spazio sotto", "min": 0, "max": 100, "step": 1, "unit": "px", "default": 24 }
  ],
  "disabled_on": { "groups": ["header", "footer"] }
}
{% endschema %}